import{r as i,j as t,D as f,h as y,i as w,k as b,l as Y,m as k,B as d,u as Z,n as V,o as ee,f as te,p as ae,q as se,s as ne,t as oe,v as ie,w as le,x as re,y as ce,z as de,A as pe,a as ue,F as S,T as me,P as ge,H as D,R as g,I as c}from"./index-DJtJpnZ_.js";import{C as he,D as Ce}from"./UserManagementPageComponent-WYe08XeO.js";import{L as xe}from"./LoadingSnackbar-DSFVQldx.js";const fe=({open:l,pipe:n,onClose:s,onSaveEdit:h})=>{const[r,p]=i.useState("");return i.useEffect(()=>{p(n==null?void 0:n.tag)},[n]),t.jsxs(f,{open:l,onClose:s,children:[t.jsxs(y,{children:['Set a tag for the Pipe called "',t.jsx("b",{children:n==null?void 0:n.name}),'"']}),t.jsxs(w,{children:[t.jsx(b,{children:t.jsx("p",{children:"This tag is used to match files with this template. Tags are case-sensitive and should not be longer than 100 letters."})}),t.jsx(Y,{autoFocus:!0,margin:"dense",label:"Tag",fullWidth:!0,variant:"outlined",value:r,onChange:u=>{p(u.target.value)}})]}),t.jsxs(k,{children:[t.jsx(d,{onClick:s,children:"Cancel"}),t.jsx(d,{onClick:()=>{h(r),s()},variant:"contained",children:"Save"})]})]})},Te=({open:l,onSaveConfirmed:n,onClose:s})=>t.jsxs(f,{open:l,onClose:s,children:[t.jsx(y,{children:"Save Pipe as Template"}),t.jsx(w,{children:t.jsx(b,{children:"This pipeline will be saved as a template and can be used by all users to create new pipelines. Please note that all input files set in this pipeline will be shared with all users as well."})}),t.jsxs(k,{children:[t.jsx(d,{onClick:s,children:"Cancel"}),t.jsx(d,{onClick:()=>{n(),s()},variant:"contained",children:"Save"})]})]}),Se=({username:l})=>{const{data:n}=Z(),s=V(),{currentUserIsAdmin:h}=ee(),r=te(e=>e.activeTab),[p,u]=i.useState(!1),[T,O]=i.useState(null),[a,C]=i.useState(void 0),[A,v]=i.useState(!1),[m,_]=i.useState(null),[I,j]=i.useState(!1),[E,M]=i.useState(null),{data:U=[]}=ae(),{data:N=[],isLoading:P}=se(l),R=ne(),z=oe(l),F=ie(),J=le(),L=re(),B=ce(),W=de(),$=async()=>{try{const e=await W.mutateAsync({name:"Untitled Dashboard",templateId:void 0}),o=D(l,e.pipe_id);s(h?{to:g.Pipe+"/"+o}:{to:g.Dashboard+"/"+o})}catch(e){c.error("Could not create new pipe: "+JSON.stringify(e))}},{setRenamePipeModalOpen:q}=pe(),H=e=>{if(e.is_template)s({to:g.Template+"/"+e.id});else{const o=D(l,e.pipe_id);s({to:g.Dashboard+"/"+o})}},G=async(e,o)=>{if(!e.is_template){console.log("Trying to edit non-template pipe");return}try{await J.mutateAsync({templateId:e.id,tag:o})}catch(x){c.error("Could not update template: "+JSON.stringify(x))}},K=async e=>{if(e.is_template){console.log("Trying to save template pipe as template");return}await z.mutateAsync({pipeId:e.pipe_id})},Q=async e=>{try{e.is_template?(await F.mutateAsync(e.id),c.info("Template deleted successfully")):(await R.mutateAsync({username:n.username,pipeId:e.pipe_id}),c.info("Pipe deleted successfully"))}catch(o){c.error(`Could not delete ${e.is_template?"template":"pipe"}: ${JSON.stringify(o)}`)}},X=async(e,o)=>{C(void 0);try{await L.mutateAsync({templateId:a==null?void 0:a.id,costCenters:e}),await B.mutateAsync({templateId:a==null?void 0:a.id,organization:o})}catch(x){c.error("Could not update template visibility: "+JSON.stringify(x))}};return P?t.jsx(xe,{loading:P}):t.jsxs(ue,{maxWidth:"lg",sx:{marginTop:6,padding:4},children:[t.jsxs(S,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",mt:5,mb:5,height:"50px"},children:[t.jsx(me,{variant:"h3",children:r===0?"Dashboards":"Templates"}),r===0&&t.jsx(d,{variant:"contained",color:"primary",onClick:()=>$(),children:"Create Dashboard"})]}),t.jsx(S,{sx:{width:"100%"},children:t.jsx(ge,{pipes:r===0?N:U,onClick:H,onEditClick:e=>{u(!0),O(e)},onVisibilityClick:e=>{C(e)},onDeleteClick:e=>{v(!0),_(e)},onRenameClick:e=>{q(!0,e.pipe_id,e.name)},onSavePipeAsTemplateClick:e=>{j(!0),M(e)},showCostCentersColumn:r!==0})}),t.jsx(fe,{open:p,pipe:T,onClose:()=>u(!1),onSaveEdit:e=>{G(T,e)}}),t.jsx(f,{open:a!==void 0,onClose:()=>C(void 0),children:t.jsx(he,{target:a==null?void 0:a.name,originalCostCentersValue:a==null?void 0:a.cost_centers,originalOrganizationId:a==null?void 0:a.organization_id,onClose:X})}),t.jsx(Ce,{open:A,objectName:m==null?void 0:m.name,onClose:()=>v(!1),onDeleteConfirmed:()=>{Q(m)}}),t.jsx(Te,{open:I,onClose:()=>j(!1),onSaveConfirmed:()=>{K(E)}})]})};export{Se as P};
