import{J as j,r as a,K as L,M as N,I as z,j as i,F as v,g as G}from"./index-DJtJpnZ_.js";import{G as k,B as Y}from"./BlockPageComponent-oCicJ4UA.js";import{S as q}from"./SubNavToolbarComponent-ylyrcG4k.js";import"./UserManagementPageComponent-WYe08XeO.js";import"./LoadingSnackbar-DSFVQldx.js";import"./Card-0SXhI6Hu.js";import"./AccordionSummary-D2HmLsdR.js";const J=j.memo(({pipeId:f,usernameFromPath:d})=>{const[u,b]=a.useState([]),[y,F]=a.useState(0),{data:n={},refetch:S}=L(f,d),{data:E={}}=N(f,d);a.useEffect(()=>{n&&n.blocks&&b(n.blocks.map(e=>e.flow_id))},[n]);const I=e=>{b(t=>t.includes(e)?t.filter(o=>o!==e):[...t,e])},M=()=>{S(),F(e=>e+1)},x=a.useMemo(()=>{var l,h;if(n.blocks===void 0)return[];let e=(l=n.blocks)==null?void 0:l.find(c=>c.blueprint.type==="import");if(e===void 0)return z.error("Could not find file import block"),[];let t=[],o=[],r=[e];for(;r.length>0;){let c=r.shift();if(o.includes(c.flow_id))continue;o.push(c.flow_id),t.push(c),(((h=n.connections)==null?void 0:h.filter(g=>g.source_flow_id===c.flow_id))||[]).forEach(g=>{var C;let _=(C=n.blocks)==null?void 0:C.find(W=>W.flow_id===g.target_flow_id);_!==void 0&&r.push(_)})}return t.filter(c=>{var B;return(B=c.dashboard_configuration)==null?void 0:B.view_in_dashboard})},[n.blocks]),{sidebarFilterBlock:T,mainBlocks:w,sideFilterBlockId:D,filterCategoriesBlocks:P}=a.useMemo(()=>{const e=x.filter(s=>s.blueprint.type==="filter_categories");let t=[],o=[...x],r=null;if(e.length>0){e.sort((l,h)=>l.order-h.order);const s=e[0];t=[s],r=s.flow_id,o=o.filter(l=>l!==s)}return{sidebarFilterBlock:t,mainBlocks:o,sideFilterBlockId:r,filterCategoriesBlocks:e}},[n.blocks]),p=P.length>0,R=(e,t)=>i.jsx(Y,{pipeId:f,nodeId:parseInt(e.flow_id),usernameFromPath:d,reload:y,showTable:!1,isDashboardItem:!0,onSelectionChanged:M,expanded:u.includes(e.flow_id),toggleExpansion:()=>I(e.flow_id),use80percentWidth:p,isFilterCategoriesSideBlock:e.flow_id===D},t),m=e=>{const t=e.reduce((o,r)=>{const s=E[r.flow_id]||r.order;return o[s]||(o[s]=[]),o[s].push(r),o},{});return Object.keys(t).map(o=>{const r=t[o];return i.jsx(j.Fragment,{children:r.map((s,l)=>R(s,l))},o)})};return a.useEffect(()=>(p?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[p]),i.jsx(i.Fragment,{children:p?i.jsx(v,{sx:{height:"100vh",overflow:"hidden"},children:i.jsxs(k,{container:!0,spacing:4,sx:{height:"100%"},children:[i.jsx(k,{item:!0,className:"aside",size:3,sx:{paddingTop:6,paddingBottom:5,overflowY:"auto",height:"100%",minWidth:"325px",backgroundColor:"unset"},children:m(T)}),i.jsx(k,{item:!0,className:"main",size:"grow",sx:{paddingTop:6,paddingLeft:1,paddingBottom:6.2,overflowY:"auto",height:"100%"},children:m(w)})]})}):i.jsx(v,{sx:{mt:7,flexDirection:"column"},children:m(w)})})}),X=function(){const{pipeId:d,username:u}=G();return i.jsx(q,{pipeId:d,username:u,shouldShowBackToPipeButton:!0,children:i.jsx(J,{pipeId:d,usernameFromPath:u})})};export{X as component};
