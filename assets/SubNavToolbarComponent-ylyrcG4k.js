import{N as b,j as e,r as c,ah as U,bg as H,bR as z,bc as A,a6 as V,n as L,g as w,ag as v,ad as B,a9 as f,bS as $,H as j,R as C,I,F as d,B as N,T as x,bT as O,bE as W,bk as J,as as S,K as _,A as K,bU as Z,bV as q}from"./index-DJtJpnZ_.js";import{L as G}from"./LoadingSnackbar-DSFVQldx.js";const Q=b(e.jsx("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3z"}),"AccountTree"),X=b(e.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),ae=b(e.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z"}),"FileDownload");function k(){const{innerWidth:n,innerHeight:t}=window;return{width:n,height:t}}function Y(){const[n,t]=c.useState(k());return c.useEffect(()=>{function s(){t(k())}return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),n}function re(n){const t=c.useRef();return c.useEffect(()=>{t.current=n}),t.current}const ce=({pipeId:n,nodeId:t,usernameFromPath:s,reload:i,isOnFlowNode:o=!1,onImageWidthCalculated:a=()=>{},use80percentWidth:l})=>{const{height:h,width:r}=Y(),{isPresentationMode:u}=U(),[P,R]=c.useState({width:0,height:0}),[g,T]=c.useState(null),{isDarkMode:y}=H(),{data:m,isLoading:E,isRefetching:F,refetch:M}=z({pipeId:n,blockId:t,username:s,sparsify:o,height:o?300:Math.round(h*.55),width:o?150:l?r*(2.8/4):r*(5/6),presentationMode:u,darkMode:y,includeDescription:!1});return c.useEffect(()=>{if(m){const p=URL.createObjectURL(m);T(p)}return()=>{g&&URL.revokeObjectURL(g)}},[m]),c.useEffect(()=>{M()},[i,u,y]),e.jsxs(e.Fragment,{children:[e.jsx(G,{loading:E||F}),g&&e.jsx("img",{src:g,alt:"",draggable:"false",style:{width:P.width,height:P.height,transform:"translateZ(0)",transformOrigin:"top left",objectFit:"contain",display:"block"},onLoad:p=>{R({width:p.target.naturalWidth,height:p.target.naturalHeight}),a(p.target.naturalWidth)}})]})};function ee(){const{api:n}=c.useContext(A),{user:t}=c.useContext(V),s=L(),{pipeId:i,username:o,isTemplate:a}=w(),l=v(o)(),h=()=>{a?n.createNewPipe("template clone",i).then(r=>{const u=j(t.username,r.data.pipe_id);s({to:`${C.Dashboard}/${u}`})}).catch(r=>{I.error("Could not clone pipe: "+JSON.stringify(r))}):n.clonePipe(i,o).then(r=>{const u=j(t.username,r.data.pipe_id);s({to:`${C.Dashboard}/${u}`})}).catch(r=>{I.error("Could not clone pipe: "+JSON.stringify(r))})};return!l&&!a?null:e.jsx(B,{title:"Clone Pipe",children:e.jsx(f,{color:"primary",onClick:h,children:e.jsx($,{})})})}const D=({username:n,pipeId:t,destination:s})=>{const i=L(),o=j(n,t);return e.jsx(B,{title:`Switch to ${s}`,children:e.jsxs(N,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:1,px:2},variant:"outlined",onClick:()=>{i({to:`/${s}/${o}`})},children:[e.jsx(x,{children:s==="dashboard"?"View Dashboard":"Edit Pipeline"}),s==="dashboard"?e.jsx(O,{}):e.jsx(Q,{})]})})};function te({username:n,shouldShowBackToDashboardButton:t,shouldShowBackToPipeButton:s,pipeId:i}){return e.jsxs(d,{children:[s&&e.jsx(D,{username:n,pipeId:i,destination:"pipe"}),t&&e.jsx(D,{username:n,pipeId:i,destination:"dashboard"})]})}function ne(){const{pipeId:n,username:t,nodeId:s,isTemplate:i}=w(),o=v(t)(),{data:a,isLoading:l}=W(n,s,t),{setEditBlockDialogOpen:h}=J();return l||!s?null:e.jsxs(d,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"end",justifyContent:"center"},children:[e.jsx(x,{variant:"body1",sx:{mr:1},children:"Block"}),e.jsx(x,{variant:"h4",sx:{whiteSpace:"nowrap",mr:1},children:a.title})]}),!o&&!i&&e.jsx(f,{onClick:()=>{h({pipeId:n,nodeId:s,username:t,title:a.title,description:a.description})},children:e.jsx(S,{})})]})}function se(){const{pipeId:n,username:t,isTemplate:s}=w(),{data:i,isLoading:o}=_(n,t,s),{setRenamePipeModalOpen:a}=K(),l=v(t)();return o||!i?null:e.jsxs(d,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"end",justifyContent:"center"},children:[e.jsx(x,{variant:"body1",sx:{mr:1},children:"Dashboard"}),e.jsx(x,{variant:"h4",sx:{whiteSpace:"nowrap",mr:1},children:i.name})]}),!l&&!s&&e.jsx(f,{onClick:()=>{a(!0,n,i.name)},children:e.jsx(S,{})})]})}function le({username:n,pipeId:t,nodeId:s,shouldShowBackToDashboardButton:i=!1,shouldShowBackToPipeButton:o=!1,children:a}){const l=Z(),h=()=>l.history.back();return e.jsxs(e.Fragment,{children:[e.jsx(q,{sx:{mt:"65px",height:"50px"},style:{borderLeft:"none",borderRight:"none",borderTop:"none"},children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",height:"100%",px:2},children:[e.jsx(d,{sx:{width:"400px"},children:e.jsx(f,{onClick:()=>h(),children:e.jsx(X,{})})}),!s&&e.jsx(se,{}),e.jsx(ne,{}),e.jsxs(d,{sx:{width:"400px",display:"flex",justifyContent:"end",gap:2},children:[e.jsx(ee,{}),e.jsx(te,{shouldShowBackToDashboardButton:i,shouldShowBackToPipeButton:o,username:n,pipeId:t})]})]})}),e.jsx(d,{sx:{mt:7,padding:3,width:"100%"},children:a})]})}export{ae as F,ce as P,le as S,re as a,Y as u};
