import{N as M,j as e,D as A,h as K,i as ee,k as W,m as $,B as I,bu as se,bv as B,ar as q,av as H,at as G,T as _,af as O,ad as U,bK as ne,o as J,r as d,bL as ae,a9 as re,bM as ie,bN as oe,bO as Q,bl as le,l as D,a7 as ce,bd as de,be as he,bc as V,ak as L,I as F,bP as ue,bQ as xe,a as pe,a8 as Z,aq as N,F as me}from"./index-DJtJpnZ_.js";const X=M(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),je=M([e.jsx("path",{d:"M17 11c.34 0 .67.04 1 .09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55-.69-.98-1.1-2.17-1.1-3.45 0-3.31 2.69-6 6-6"},"0"),e.jsx("path",{d:"M17 13c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 1.38c.62 0 1.12.51 1.12 1.12s-.51 1.12-1.12 1.12-1.12-.51-1.12-1.12.5-1.12 1.12-1.12m0 5.37c-.93 0-1.74-.46-2.24-1.17.05-.72 1.51-1.08 2.24-1.08s2.19.36 2.24 1.08c-.5.71-1.31 1.17-2.24 1.17"},"1")],"AdminPanelSettings"),Ce=M(e.jsx("path",{d:"m4 12 1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8z"}),"ArrowUpward"),ve=M(e.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link"),ge=M(e.jsx("path",{d:"M17 7h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.43-.98 2.63-2.31 2.98l1.46 1.46C20.88 15.61 22 13.95 22 12c0-2.76-2.24-5-5-5m-1 4h-2.19l2 2H16zM2 4.27l3.11 3.11C3.29 8.12 2 9.91 2 12c0 2.76 2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1 0-1.59 1.21-2.9 2.76-3.07L8.73 11H8v2h2.73L13 15.27V17h1.73l4.01 4L20 19.74 3.27 3z"}),"LinkOff"),Se=({open:s,objectName:i,onClose:u,onDeleteConfirmed:c})=>e.jsxs(A,{open:s,onClose:u,children:[e.jsxs(K,{children:['Do you really want to delete "',e.jsx("b",{children:i}),'"?']}),e.jsx(ee,{children:e.jsx(W,{children:e.jsxs("p",{children:['This action cannot be undone. Are you sure you want to delete "',i,'"?']})})}),e.jsxs($,{children:[e.jsx(I,{onClick:u,children:"Cancel"}),e.jsx(I,{onClick:()=>{c(),u()},variant:"contained",color:"error",children:"Delete"})]})]}),be=({config:s,onVisibilityChange:i})=>{const u=a=>{s.options&&s.options.forEach(r=>{var x;((x=s.hidden_options)==null?void 0:x.includes(r))===a&&i(r)})},c=()=>!s.options||s.options.length===0?!1:!s.options.some(a=>{var r;return(r=s.hidden_options)==null?void 0:r.includes(a)});return e.jsxs(se,{dense:!0,children:[e.jsxs(B,{dense:!0,sx:{ml:-4,wordWrap:"break-word",maxWidth:"100%",mt:-4,mb:-2,py:-2},children:[e.jsx(q,{children:e.jsx(H,{checked:c(),indeterminate:s.options&&s.options.length>0&&!c()&&s.options.some(a=>{var r;return!((r=s.hidden_options)!=null&&r.includes(a))}),onChange:a=>u(a.target.checked)})}),e.jsx(G,{primary:e.jsx(_,{variant:"caption",children:e.jsx("strong",{children:"Select All"})})})]}),s.options&&s.options.map((a,r)=>{var j;return e.jsxs(B,{dense:!0,sx:{ml:-4,wordWrap:"break-word",width:"120%",my:-2,py:-2},children:[e.jsx(q,{children:e.jsx(H,{checked:!((j=s.hidden_options)!=null&&j.includes(a)),onChange:()=>i(a)})}),e.jsx(G,{primary:a})]},r)})]})},fe=({config:s,onChangeIsSynced:i,onChangeSortDescending:u})=>e.jsxs(O,{direction:"row",children:[e.jsx(_,{variant:"h6",children:s.name}),!(isNaN(s.is_synced)||s.is_synced===null)&&e.jsx(U,{title:s.is_synced?"Unsync axes":"Sync axes",children:e.jsx(H,{sx:{mt:-.5},checked:s.is_synced,icon:e.jsx(ge,{}),checkedIcon:e.jsx(ve,{}),onChange:c=>{let a=c.target.checked;i(a)}})}),!(isNaN(s.sort_ascending)||s.sort_ascending===null)&&e.jsx(U,{title:s.sort_ascending==!0?"Sort descending":"Sort ascending",children:e.jsx(H,{sx:{mt:-.5},checked:s.sort_ascending,icon:e.jsx(ne,{}),checkedIcon:e.jsx(Ce,{}),onChange:c=>{let a=c.target.checked;u(a)}})})]}),De=({onSaveConfig:s,isForeignPipe:i,initialConfig:u={},isShowTableBlock:c=!1,isAdminMode:a=!1,onAdminModeToggle:r,pipeId:j,nodeId:x,username:y})=>{const{currentUserIsAdmin:b}=J(),[h,v]=d.useState({elements:[]}),m=ae();d.useEffect(()=>{v(u)},[u]);const f=(n,o)=>{let t={...h};t.elements[o].selected_values=[n??""],v(t)},p=(n,o)=>{let t={...h},l=t.elements[o].selected_values||[];c?(l.includes(n)?l=l.filter(P=>P!==n):l.push(n),t.elements[o].selected_values=l):t.elements[o].selected_values=n,v(t)},g=(n,o,t)=>{let l={...h};l.elements[n].options=o;const P=o.filter(R=>t.includes(R));l.elements[n].selected_values=P,v(l)},S=(n,o)=>{let t={...h};t.elements[n].is_synced=o,v(t)},k=(n,o)=>{let t={...h};t.elements[n].sort_ascending=o,v(t)},T=(n,o)=>{let t={...h};const l=t.elements[n];l.hidden_options||(l.hidden_options=[]),l.hidden_options.includes(o)?l.hidden_options=l.hidden_options.filter(P=>P!==o):l.hidden_options.push(o),v(t)},z=(n,o)=>{let t={...h};t.elements[n].toggle=o,v(t)},C=(n,o)=>{let t={...h};t.elements[n].selected_values=[o],v(t)},w=()=>{m.mutate({pipeId:j,nodeId:x,username:y,configuration:h},{onSuccess:()=>{s(h)}})};return e.jsxs(se,{sx:{mt:6},children:[b&&e.jsx(O,{direction:"row",justifyContent:"space-between",sx:{p:1},children:e.jsxs("div",{children:[e.jsx(U,{title:a?"Switch to Normal Mode":"Switch to Admin Mode",children:e.jsx(re,{onClick:r,children:e.jsx(je,{color:a?"primary":"inherit"})})}),e.jsx(_,{variant:"caption",children:a?"Switch to Normal Mode":"Switch to Admin Mode"})]})}),h.elements.map((n,o)=>e.jsx(B,{children:e.jsxs(O,{direction:"column",sx:{width:"100%"},children:[(n.type==="single_select"||n.type==="multi_select")&&e.jsx(Y,{config:n,onSelectOption:t=>{n.type==="single_select"?f(t,o):n.type==="multi_select"&&p(t,o)},isForeignPipe:i,onChangeIsSynced:t=>S(o,t),onChangeSortDescending:t=>k(o,t),onVisibilityChange:t=>T(o,t),onOptionsReorder:(t,l)=>g(o,t,l),isAdminMode:a,allowMultiple:n.type==="multi_select"}),n.type==="toggle_switch"&&e.jsxs(O,{direction:"row",alignItems:"center",children:[e.jsx(_,{variant:"h6",children:n.name}),e.jsx(U,{title:n.disabled?"Violin not supported when Color is selected":"",children:e.jsx("span",{children:e.jsx(ie,{checked:n.toggle,onChange:t=>z(o,t.target.checked),disabled:n.disabled===!0})})})]}),n.type==="slider"&&e.jsxs(O,{direction:"column",alignItems:"flex-start",children:[e.jsx(_,{variant:"h6",children:n.name}),e.jsxs(_,{variant:"body2",children:["Max Value: ",n.selected_values[0]??30]}),e.jsx(oe,{value:n.selected_values[0]??30,onChange:(t,l)=>C(o,l),min:n.min||2,max:n.max||100,step:n.step||1,marks:n.marks||!1})]})]})},o)),e.jsx(I,{variant:"contained",sx:{ml:2,mb:2},onClick:w,disabled:i()||m.isPending,children:m.isPending?"Saving...":"Save & Reload"})]})},Y=({config:s,onSelectOption:i,isForeignPipe:u=()=>!1,onChangeIsSynced:c,onChangeSortDescending:a,onOptionsReorder:r,isAdminMode:j,onVisibilityChange:x,allowMultiple:y=!1})=>{var f;const[b,h]=d.useState(((f=s.options)==null?void 0:f.filter(p=>{var g;return!((g=s.hidden_options)!=null&&g.includes(p))}))||[]),{currentUserIsAdmin:v}=J();d.useEffect(()=>{var g;const p=j?s.options||[]:((g=s.options)==null?void 0:g.filter(S=>{var k;return!((k=s.hidden_options)!=null&&k.includes(S))}))||[];h(p)},[s.options,s.hidden_options,j]);const m=s.selected_values.filter(p=>{var g;return p&&!((g=s.options)!=null&&g.includes(p))});return e.jsxs(O,{direction:"column",children:[e.jsx(fe,{config:s,onChangeIsSynced:c,onChangeSortDescending:a}),j?e.jsx(be,{config:s,onVisibilityChange:x}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{multiple:!0,options:b,disabled:u()||s.name==="Correlation Metric"&&!v,disableCloseOnSelect:y,value:y?s.selected_values:s.selected_values[0]===""?[]:s.selected_values,getOptionLabel:p=>`${p}`,onChange:(p,g)=>{i(y?g:g[g.length-1])},sx:{maxWidth:"13vw"},renderInput:p=>e.jsx(D,{...p,variant:"outlined",placeholder:y?"Select options":"Select option",fullWidth:!0}),renderTags:(p,g)=>p.map((S,k)=>e.jsx(U,{title:S,children:e.jsx(le,{label:S,...g({index:k})})}))}),m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(_,{variant:"h6",color:"error",sx:{mt:2},children:"Invalid options"}),e.jsx(Q,{multiple:!0,options:m,getOptionLabel:p=>`${p}`,value:m,disabled:!0,renderInput:p=>e.jsx(D,{...p,variant:"standard",label:"Invalid options"})})]})]})]})},we=s=>s.map((i,u)=>(Object.keys(i).forEach(c=>{const a=i[c];typeof a=="number"&&(i[c]=a.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:4}))}),i)),ye=({data:s,initialSelectionState:i={},handleFilterChange:u=void 0,onRowSelection:c=void 0,categoricalFilter:a=!1,category:r=void 0,generateRowActionItems:j=void 0,disabledRows:x=void 0,isForeignPipe:y,isLoading:b=!1})=>{const h=ce(),v=c!==void 0,m=j!==void 0,f=(v||a)&&!y(),[p,g]=d.useState(i),S=(C,w)=>{var n=[];return C.length>0&&(n=Object.keys(C[0])),w&&m&&n.indexOf("mrt-row-actions")===-1&&n.splice(0,0,"mrt-row-actions"),w&&f&&n.indexOf("mrt-row-select")===-1&&n.splice(0,0,"mrt-row-select"),n},k=C=>{let w=C.indexOf("count");return w!==-1&&(C.splice(w,1),C.push("count")),C},T=C=>s===void 0||s.length==0?[]:C.map(n=>{var o={accessorKey:n,header:n};return a&&(o.size="150"),n==="count"&&(o.header="#",o.size="80"),o}),z=C=>(x==null?void 0:x.includes(C.original[r]))??!1;return d.useEffect(()=>{i&&JSON.stringify(p)!==JSON.stringify(i)&&g(i)},[i]),d.useEffect(()=>{if(a)u(p);else{let C=Object.keys(p);C.length===1&&c(parseInt(C[0]))}},[p]),e.jsx(de,{columns:T(k(S(s,!1))),data:we(s),enableRowSelection:f,enableMultiRowSelection:a,enableStickyHeader:!0,enableTopToolbar:!1,enableClickToCopy:!1,enableColumnResizing:!0,enableFullScreenToggle:!1,enableRowActions:m,autoResetPageIndex:!1,selectAllMode:"all",displayColumnDefOptions:{"mrt-row-select":{size:20},"mrt-row-actions":{size:20}},getRowId:(C,w)=>a?C[r]:w,renderRowActionMenuItems:j,onRowSelectionChange:g,initialState:{density:"compact",rowSelection:p,columnOrder:k(S(s,!0))},muiSelectCheckboxProps:({row:C})=>({disabled:b||z(C)}),muiPaginationProps:{showRowsPerPage:!1},muiBottomToolbarProps:({table:C})=>{var o,t,l,P,R;let w=(P=(l=(t=(o=C.refs.bottomToolbarRef.current)==null?void 0:o.children[0])==null?void 0:t.children[1])==null?void 0:l.children[0])==null?void 0:P.children;var n=!1;return w&&w.length>1&&(n=((R=w[1])==null?void 0:R.offsetTop)>20),{sx:{height:n?"80px":"50px"}}},state:{rowSelection:p,isSaving:b,columnOrder:k(S(s,!0))},mrtTheme:he(h)})},_e=({onSignupButtonClick:s})=>{const[i,u]=d.useState(""),[c,a]=d.useState(""),[r,j]=d.useState("");return e.jsxs(O,{direction:"column",spacing:2,children:[e.jsx(_,{variant:"h4",children:"Create Account"}),e.jsx(D,{label:"username",value:i,variant:"outlined",onChange:x=>{u(x.target.value)}}),e.jsx(D,{label:"name",value:c,variant:"outlined",onChange:x=>{a(x.target.value)}}),e.jsx(D,{label:"password",type:"password",variant:"outlined",value:r,onChange:x=>{j(x.target.value)}}),e.jsx(I,{variant:"contained",onClick:()=>{s(i,c,r)},children:"Sign up"})]})},Oe=({onClose:s})=>{const{api:i}=d.useContext(V),[u,c]=d.useState(""),[a,r]=d.useState(!1),[j,x]=d.useState(!1),y=(b,h,v)=>{if(b===""||h===""||v===""){c("You have to fill in the values!"),r(!0);return}i.signup({username:b,name:h,password:v}).then(m=>{F.info("Sign up success: "+m),c(""),r(!1),x(!0)}).catch(m=>{F.error("Sign up error: "+m),r(!0),m.response.data&&m.response.data.type?c(m.response.data.type):c(m.message)})};return e.jsx(L,{additionalSx:{width:250,mt:0,ml:"auto",mr:"auto"},children:e.jsxs(O,{direction:"column",spacing:2,children:[e.jsx(_e,{onSignupButtonClick:y}),a&&e.jsx("div",{className:"alert alert-light",role:"alert",children:u}),e.jsxs(A,{open:j,onClose:()=>{x(!1)},children:[e.jsx(K,{children:"Signup Successful"}),e.jsx(W,{children:"A new account has been created"}),e.jsx($,{children:e.jsx(I,{variant:"contained",onClick:()=>{x(!1),s()},children:"Okay"})})]})]})})},E={Admin:"Admin",KeyUser:"Key User",User:"User"},ke=({selectedOption:s,onSelectOption:i})=>e.jsx(L,{additionalSx:{mt:0},children:e.jsxs(O,{direction:"column",spacing:2,children:[e.jsx(_,{variant:"h4",children:"Change Role"}),e.jsx(Y,{config:{selected_values:[s],options:[E.Admin,E.User]},onSelectOption:i})]})}),Pe=({onSave:s})=>{const[i,u]=d.useState("");return e.jsx(L,{additionalSx:{mt:0},children:e.jsxs(O,{direction:"column",spacing:2,children:[e.jsx(_,{variant:"h4",children:"Create Organization"}),e.jsx(D,{label:"Organization Name",variant:"outlined",value:i,onChange:c=>{u(c.target.value)}}),e.jsx(me,{children:e.jsx(I,{variant:"contained",sx:{ml:"auto",display:"flex"},onClick:()=>s(i),children:"Save"})})]})})},te=({selectedOption:s,onSelectOption:i})=>{const{api:u}=d.useContext(V),[c,a]=d.useState([]);return d.useEffect(()=>{u.getOrganizations().then(r=>{let j=r.data.map(x=>x.name);a(j),s&&Number.isInteger(Number(s))&&i(j[s])}).catch(r=>{F.error(r)})},[]),e.jsx(Y,{config:{selected_values:s?[s]:[],options:c},onSelectOption:i})},Ie=({username:s,open:i,onClose:u,onSuccess:c})=>{let{api:a}=d.useContext(V),[r,j]=d.useState("");return e.jsxs(A,{open:i,onClose:u,children:[e.jsxs(K,{children:["Do you really want to reset the password for user ",e.jsx("b",{children:s}),"?"]}),e.jsxs(ee,{children:[e.jsx(W,{children:"Please enter a new password for the user."}),e.jsx(D,{label:"password",type:"password",variant:"outlined",value:r,onChange:x=>{j(x.target.value)}})]}),e.jsxs($,{children:[e.jsx(I,{onClick:u,children:"Cancel"}),e.jsx(I,{onClick:()=>{u(),a.resetPassword(s,r).then(c)},variant:"contained",children:"Reset Password"})]})]})},Te=({target:s,originalCostCentersValue:i,originalOrganizationId:u,onClose:c})=>{let{api:a}=d.useContext(V),[r,j]=d.useState(i),[x,y]=d.useState("");const b=h=>{if(h===""||!h)return!0;const v=new RegExp(`^(all|[A-Z]{1,3})\\${xe}(all|[\\w]+)$`);return h.split(ue).every(f=>v.test(f.trim()))};return d.useEffect(()=>{u&&a.getOrganizations().then(h=>{let m=h.data.find(f=>f.id===u);m&&y(m.name)})},[u]),e.jsx(L,{additionalSx:{mt:0},children:e.jsxs(O,{direction:"column",spacing:2,children:[e.jsxs(_,{variant:"h5",children:["Change the Visibility for ",e.jsx("b",{children:s})]}),e.jsxs(_,{variant:"body",children:["Please enter a comma-separated list of values in the format"," ",e.jsx("b",{children:"CROP|COST CENTER"}),". You are allowed to use 'all' as a placeholder for both values."]}),e.jsx(D,{label:"Cost Centers",variant:"outlined",value:r,onChange:h=>{j(h.target.value)},error:!b(r),helperText:b(r)?"":"Invalid format. Use format CROP|COST CENTER, separated by commas."}),e.jsxs(O,{direction:"row",children:[e.jsxs(_,{variant:"body",sx:{alignContent:"center",mr:2},children:["Organization:"," "]}),e.jsx(te,{selectedOption:x,onSelectOption:y})]}),e.jsx(I,{onClick:()=>{b(r)&&c(r,x)},variant:"contained",disabled:!b(r),children:"Save Changes"})]})})},Re=()=>{let{api:s}=d.useContext(V),{isKws:i}=J(),[u,c]=d.useState([]),[a,r]=d.useState(0),[j,x]=d.useState(!1),[y,b]=d.useState(!1),[h,v]=d.useState(void 0),[m,f]=d.useState(void 0),[p,g]=d.useState(void 0),[S,k]=d.useState(void 0),[T,z]=d.useState(void 0);d.useEffect(()=>{s.getUsers().then(t=>{w(t.data)}).catch(t=>{console.log(t)})},[a]);const C=t=>t.permissions.some(l=>l.name===Z.MANAGE_USERS)?E.Admin:t.permissions.some(l=>l.name===Z.ADMIN)?E.KeyUser:E.User,w=t=>{let l=t.map(P=>{var R;return{username:P.username,name:P.name,organization:(R=P.organization)==null?void 0:R.name,role:C(P),cost_centers:P.cost_centers}});c(l)},n=({closeMenu:t,row:l})=>i?[e.jsx(N,{onClick:()=>{f(l.original),t()},children:"Change organization"},2)]:[e.jsx(N,{onClick:()=>{g(l.original),t()},children:"Reset Password"},0),e.jsx(N,{onClick:()=>{v(l.original),t()},children:"Change roles"},1),e.jsx(N,{onClick:()=>{f(l.original),t()},children:"Change organization"},2),e.jsx(N,{onClick:()=>{k(l.original),t()},children:"Change cost centers and crops"},3),e.jsx(N,{onClick:()=>{z(l.original),t()},children:"Delete User"},4)],o=t=>{s.createOrganization(t).then(l=>{r(a+1)})};return e.jsx(pe,{maxWidth:"lg",sx:{marginTop:6,padding:4},children:e.jsxs(L,{children:[e.jsxs(O,{direction:"column",spacing:2,children:[e.jsxs(O,{direction:"row",spacing:2,children:[e.jsx(_,{variant:"h5",children:"User Management"}),e.jsx(U,{title:"Please create users in the external auth tool",children:e.jsx("span",{children:e.jsx(I,{variant:"contained",size:"small",disabled:!0,startIcon:e.jsx(X,{}),onClick:()=>{x(!0)},children:"Create new user"})})}),e.jsx("span",{children:e.jsx(I,{variant:"contained",size:"small",startIcon:e.jsx(X,{}),onClick:()=>{b(!0)},children:"Create new Org"})})]}),e.jsx(ye,{data:u,generateRowActionItems:n})]}),e.jsx(A,{open:j,onClose:()=>x(!1),children:e.jsx(Oe,{onClose:()=>x(!1)})}),e.jsx(A,{open:y,onClose:()=>b(!1),children:e.jsx(Pe,{onSave:t=>{o(t),b(!1)}})}),e.jsx(Ie,{username:p==null?void 0:p.username,open:p!==void 0,onClose:()=>g(void 0),onSuccess:()=>{r(a+1)}}),e.jsx(A,{open:h!==void 0,onClose:()=>v(void 0),children:e.jsx(ke,{selectedOption:h==null?void 0:h.role,onSelectOption:t=>{v(void 0),s.updateUserRole(h==null?void 0:h.username,t).then(l=>{r(a+1)})}})}),e.jsx(A,{open:m!==void 0,onClose:()=>f(void 0),children:e.jsx(L,{additionalSx:{mt:0},children:e.jsxs(O,{direction:"column",spacing:2,children:[e.jsx(_,{variant:"h4",children:"Change Organization"}),e.jsx(te,{selectedOption:m==null?void 0:m.organization,onSelectOption:t=>{f(void 0),s.updateUserOrganization(m==null?void 0:m.username,t).then(l=>{r(a+1)})}})]})})}),e.jsx(A,{open:S!==void 0,onClose:()=>k(void 0),children:e.jsx(Te,{target:S==null?void 0:S.username,originalCostCentersValue:S==null?void 0:S.cost_centers,onClose:t=>{k(void 0),s.updateUserCostCenters(S==null?void 0:S.username,t).then(l=>{r(a+1)})}})}),e.jsx(Se,{open:T!==void 0,objectName:T==null?void 0:T.username,onClose:()=>z(void 0),onDeleteConfirmed:()=>{s.deleteUser(T.username).then(t=>{r(a+1)})}})]})})};export{Te as C,Se as D,ve as L,Y as M,ye as S,Re as U,ge as a,De as b,we as t};
